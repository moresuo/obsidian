***
## ä¼ä¸šåšé¡¹ç›®æµç¨‹
***
1. éœ€æ±‚åˆ†æï¼šåˆ†æéœ€æ±‚çš„åˆç†æ€§
2. è®¾è®¡ï¼šæ¦‚è¦è®¾è®¡ï¼Œè¯¦ç»†è®¾è®¡
3. æŠ€æœ¯é€‰å‹ï¼šåšä¸€ä¸ªéœ€æ±‚é€‰ç”¨ä»€ä¹ˆæŠ€æœ¯ (java, go, pythonâ€¦â€¦)
4. åˆå§‹åŒ–é¡¹ç›®/å¼•å…¥éœ€è¦çš„æŠ€æœ¯
5. å†™ Demo, æµ‹è¯•ç”¨ä¾‹
6. å†™ä»£ç ï¼Œå®ç°ä¸šåŠ¡é€»è¾‘
7. æµ‹è¯• (å•å…ƒæµ‹è¯• )
8. ä»£ç æäº¤
9. éƒ¨ç½²ã€å‘å¸ƒ
## éœ€æ±‚åˆ†æ
1. ç™»å½•æ³¨å†Œ
2. ç”¨æˆ·ç®¡ç† (ç®¡ç†å‘˜å¯è§)ï¼Œå¯¹ç”¨æˆ·çš„æŸ¥è¯¢ã€ä¿®æ”¹
3. ç”¨æˆ·æ ¡éªŒï¼ˆ<mark style="background: #ABF7F7A6;">ä»… VIP ç”¨æˆ·å¯è§</mark>ï¼‰
## æŠ€æœ¯é€‰å‹
- å‰ç«¯ï¼šå‰ç«¯ä¸‰ä»¶å¥—+React+ç»„ä»¶åº“ Ant Design (åˆ«äººå¸®æˆ‘ä»¬å†™å¥½çš„é¡µé¢)+Umi (é˜¿é‡Œå·´å·´å¼€å‘æ¡†æ¶)+Ant Design Pro (ç°æˆçš„ç®¡ç†ç³»ç»Ÿ)
- åç«¯ï¼šjava+spring+springMVC+MyBatis+Mybatis-Plus+Springboot+MySQL
- éƒ¨ç½²ï¼šæœåŠ¡å™¨/å®¹å™¨ (å¹³å°)
## è®¡åˆ’
***
1. åˆå§‹åŒ–é¡¹ç›®
	1. å‰ç«¯åˆå§‹åŒ–
		1. åˆå§‹åŒ–é¡¹ç›®
		2. å¼•å…¥ç»„ä»¶
		3. é¡¹ç›®ç˜¦èº«
	2. åç«¯åˆå§‹åŒ–
		1. ç¯å¢ƒå‡†å¤‡ (MySQL, IDEA)
		2. æ•´åˆæ¡†æ¶
2. ç™»å½•/æ³¨å†Œ
	1. å‰ç«¯
	2. åç«¯
3. ç”¨æˆ·ç®¡ç†
	1. å‰ç«¯
	2. åç«¯
### å‰ç«¯åˆå§‹åŒ–
1. ä¸‹è½½ node. Js
2. Ant Design Pro, å®˜ç½‘ï¼š[å¼€ç®±å³ç”¨çš„ä¸­å°å‰ç«¯/è®¾è®¡è§£å†³æ–¹æ¡ˆ - Ant Design Pro](https://pro.ant.design/zh-CN/)
åˆå§‹åŒ–è„šæ‰‹æ¶ï¼š
- æ‰“å¼€ cmd å‘½ä»¤çª—å£ï¼Œæ¨èåœ¨åšé¡¹ç›®çš„æ–‡ä»¶å¤¹ä¸‹æ‰“å¼€ cmd çª—å£, è¾“å…¥ä»¥ä¸‹å‘½ä»¤
```shell
# ä½¿ç”¨ npm
npm i @ant-design/pro-cli -g
pro create myapp
```
![[Pasted image 20231130165243.png]]
- å‡ºç°é—®é¢˜ï¼š
![[Pasted image 20231130165847.png]]
æŠŠä½ çš„ VPN å…³äº†ğŸ˜…ã€‚æˆ–è€…ä½¿ç”¨ yarn çš„æ–¹å¼å®‰è£…
- ä½¿ç”¨ yarn å®‰è£…
```shell
yarn create umi myapp
```

![[Pasted image 20231130170626.png]]
![[Pasted image 20231130170720.png]]
![[Pasted image 20231130171135.png]]
- å®‰è£… webStorm, ä¸‹è½½åœ°å€ï¼š[å…¶ä»–ç‰ˆæœ¬ - WebStorm (jetbrains.com)](https://www.jetbrains.com/webstorm/download/other.html)
- ç ´è§£æ•™ç¨‹ï¼š[Webstorm 2023.2.4 æœ€æ–°æ¿€æ´»ç ,ç ´è§£ç‰ˆå®‰è£…æ•™ç¨‹ï¼ˆäº²æµ‹æœ‰æ•ˆï¼‰ - çŠ¬å°å“ˆæ•™ç¨‹ (quanxiaoha.com)](https://www.quanxiaoha.com/webstorm-pojie/webstorm-pojie-202324.html)
- æ‰“å¼€åˆšæ‰åˆ›å»ºçš„è„šæ‰‹æ¶ myApp
- è¿›å…¥ç»ˆç«¯ï¼Œè¾“å…¥ yarn è‡ªåŠ¨å®‰è£…ç›¸å…³ä¾èµ–
![[Pasted image 20231130173404.png]]
- ç‚¹å‡» <mark style="background: #FF5582A6;">package. Json</mark>, æ‰¾åˆ° start æ ‡è¯†ã€‚ç‚¹å‡»è¿›è¡Œå¯åŠ¨
![[Pasted image 20231130173928.png]]
- æ·»åŠ  umi UI (å¯ä»¥å¸®åŠ©æˆ‘ä»¬è‡ªåŠ¨ç”Ÿæˆä»£ç )
```shell
yarn add @umijs/preset-ui -D
```
### åç«¯åˆå§‹åŒ–
- å®‰è£… MySQL æ•°æ®åº“
- åœ¨ IDEA ä¸­æ–°å»ºä¸€ä¸ª SpringBoot é¡¹ç›®
![[Pasted image 20231130191652.png]]
- é€‰æ‹©é¡¹ç›®ä¾èµ–
	- Spring Boot DevTools: å¸®åŠ©æˆ‘ä»¬åœ¨æ›´æ”¹ä»£ç ä¹‹åè‡ªåŠ¨é‡å¯
	- Lombok: é€šè¿‡æ³¨è§£çš„æ–¹å¼å®Œæˆå¯¹ä¸€ä¸ª javaBean çš„ set, get, toString æ–¹æ³•çš„çœç•¥ç¼–å†™
	- MySQL Driver: MySQL çš„é©±åŠ¨
	- Spring Web: Spring  MVC ç›¸å…³ä¾èµ–ï¼Œæä¾› web è®¿é—®æ¥å£ï¼Œä¾‹å¦‚ Restful ä»£ç çš„ç¼–å†™
	- MyBatis: æ•°æ®è®¿é—®å±‚çš„ä¸€ä¸ªæ¡†æ¶ï¼Œå¯¹æ•°æ®è¿›è¡Œå¢åˆ æ”¹æŸ¥
![[Pasted image 20231130192420.png]]
- åœ¨ IDEA ä¸­è¿æ¥ MySQL æ•°æ®åº“ï¼Œå…¶å®å°±å¯ä»¥ä¸ç”¨ navicat äº†ğŸ‘
![[Pasted image 20231130193010.png]]
![[Pasted image 20231130193102.png]]
- å¼•å…¥ MyBatis-Plus æ¡†æ¶ä¾èµ–, MyBatis æ˜¯å¯¹ JDBC çš„å°è£…ï¼ŒMyBatis -plus æ˜¯å¯¹ MyBatis çš„å°è£…ï¼Œå¯¹ä¸€äº›å¸¸ç”¨çš„å¢åˆ æ”¹æŸ¥è¿›è¡Œäº†å°è£…ï¼Œä¸ç”¨åœ¨ç¼–å†™ SQLğŸ‘
```xml
<dependency>
    <groupId>com.baomidou</groupId>
    <artifactId>mybatis-plus-boot-starter</artifactId>
    <version>3.4.2</version>
</dependency>
```
- å°†é…ç½®æ–‡ä»¶çš„ properties æ”¹ä¸º yml, yml æ ¼å¼æœ‰æç¤ºä¸”å¯è¯»æ€§æ›´é«˜ï¼Œç¼–å†™é…ç½®æ–‡ä»¶åˆå§‹ä¿¡æ¯
```yaml
spring:  
  application:  
    name: user-center #é¡¹ç›®åç§°  
  datasource: #æ•°æ®åº“é…ç½®  
    driver-class-name: com.mysql.cj.jdbc.Driver  
    url: jdbc:mysql://localhost:3306/yupi?serverTimezone=UTC  
    username: root  
    password: 
server:  
  port: 8080 #é¡¹ç›®ç«¯å£å·
```
- åœ¨å¯åŠ¨ç±»ä¸Šæ‰«æ mapper åŒ…çš„æ³¨è§£ï¼Œ`@MapperScan("com.yhk.usercenter.mapper")`

> [!warning]- æ³¨æ„
> æµ‹è¯•ç±»è¦ä¸å¯åŠ¨ç±»çš„è·¯å¾„ä¸€è‡´ï¼Œå¦‚æœä¸ä¸€è‡´çš„è¯å°±è¦åœ¨æµ‹è¯•ç±»ä¸Šçš„@SpringBootTest æ³¨è§£ä¸­æŒ‡å®šå¯åŠ¨ç±»ï¼Œä¾‹å¦‚ï¼š `@SprintBootTest({"userCenterApplication"})`,æˆ–è€…åœ¨æµ‹è¯•ç±»ä¸ŠåŠ ä¸Š `@RunWith(SpringRunner.class)`

### æ•°æ®åº“è®¾è®¡-åç«¯
| id         | ä¸»é”®                | varchar  |
| ---------- | ------------------- | -------- |
| username   | æ˜µç§°                | varchar  |
| gender     | æ€§åˆ«                | tinyint  |
| password   | å¯†ç                 | varchar  |
| phone      | ç”µè¯                | varchar  |
| email      | é‚®ç®±                | varchar  |
| status    | ç”¨æˆ·çŠ¶æ€            | int  |
| avatarUrl  | å¤´åƒ                | varchar  |
| createTime | æ•°æ®æ’å…¥æ—¶é—´        | datetime |
| updateTime | æ•°æ®æ›´æ–°æ—¶é—´        | datatime |
| isDelete   | æ˜¯å¦åˆ é™¤ (é€»è¾‘åˆ é™¤) | tinyint  |
| account    | ç™»å½•è´¦å·            | varchar         |
<mark style="background: #ABF7F7A6;">åç»­å¼€å‘å¯ä»¥ç»§ç»­æ·»åŠ å­—æ®µï¼Œä¸è¦è¿‡åº¦è®¾è®¡</mark>
æ€§åˆ«ä¸ç”¨åŠ ç´¢å¼•ï¼Œå› ä¸ºæ€§åˆ«ç¦»æ•£åº¦ä½ï¼Œæ²¡å¿…è¦åŠ ç´¢å¼•

- åœ¨ IDEA ä¸­è®¾è®¡ä¸€ä¸ªè¡¨
![[Pasted image 20231202154256.png]]

> [!warning]- æ³¨æ„
> Account åœ¨ MySQL 5.7 ä¸ºå…³é”®å­—ï¼Œåœ¨å»ºè¡¨æ—¶å°½é‡ä¸è¦ç”¨å…³é”®å­—ï¼Œè™½ç„¶å¯ä»¥ç”¨å¼•å·å¼•èµ·æ¥ï¼Œä½†æ˜¯ä»¥é˜²ä¸‡ä¸€æœ‰ä¸€å¤©å¿˜äº†

<mark style="background: #ABF7F7A6;">åœ¨ MySQL æ•°æ®åº“ä¸­ä¸æ”¯æŒä¸¤ä¸ªç›¸åŒçš„é»˜è®¤ current_time</mark>,æ¨èä½¿ç”¨é»˜è®¤çš„ `CURRENT_TIMESTAMP`
![[Pasted image 20231202160446.png]]
```sql
create table user  
(  
    id          bigint auto_increment comment 'ä¸»é”®'  
        primary key,  
    username    varchar(256)                       null comment 'ç”¨æˆ·æ˜µç§°',  
    userAccount varchar(256)                       null comment 'è´¦å·',  
    avatarUrl   varchar(1024)                      null comment 'ç”¨æˆ·å¤´åƒ',  
    gender      tinyint                            null comment 'æ€§åˆ«',  
    password    varchar(512)                       not null comment 'å¯†ç ',  
    phone       varchar(128)                       null comment 'æ‰‹æœºå·ç ',  
    email       varchar(512)                       null comment 'é‚®ç®±',  
    status      int      default 0                 not null comment 'ç”¨æˆ·çŠ¶æ€,0-æ­£å¸¸',  
    createTime  datetime default CURRENT_TIMESTAMP null comment 'åˆ›å»ºæ—¶é—´,é»˜è®¤æ˜¯å½“å‰æ—¶é—´',  
    updateTime  datetime default CURRENT_TIMESTAMP null comment 'æ›´æ–°æ—¶é—´',  
    idDelete    tinyint  default 0                 not null comment 'æ˜¯å¦åˆ é™¤(é€»è¾‘åˆ é™¤),é»˜è®¤ä¸º0'  
)  
    comment 'ç”¨æˆ·è¡¨';
```

### ç™»å½•æ³¨å†Œ-åç«¯
1. è§„æ•´é¡¹ç›®ç›®å½•
	- Controller: ç”¨æˆ·æ¥å— web è¯·æ±‚
	- Service: å¤„ç†ä¸šåŠ¡é€»è¾‘
	- Mapper: æ•°æ®åº“è®¿é—®å±‚ï¼Œæ“ä½œæ•°æ®
	- Model: å­˜æ”¾å®ä½“ç±»
	- Utils: å­˜æ”¾å·¥å…·ç±»
![[Pasted image 20231202162115.png]]
2. å®ç°åŸºæœ¬æ•°æ®åº“æ“ä½œ (æ“ä½œ user è¡¨)
- åˆ›å»º user å¯¹è±¡ï¼Œä¸ User è¡¨è¿›è¡Œå­—æ®µæ˜ å°„ï¼Œ<mark style="background: #FF5582A6;">è‡ªåŠ¨ç”Ÿæˆå®ä½“ç±»</mark>ï¼Œä¸‹è½½ MyBatisX æ’ä»¶
![[Pasted image 20231202162650.png]]
- å³é”®ç‚¹å‡»è¡¨ï¼Œé€‰æ‹© MyBatisX åŠŸèƒ½é¡¹
![[Pasted image 20231202163416.png]]
![[Pasted image 20231202163517.png]]
- åœ¨æµ‹è¯•æ—¶ï¼Œæˆ‘ä»¬ç»å¸¸æ‰‹åŠ¨çš„è°ƒç”¨ä¸€ä¸ªå¯¹è±¡çš„ set æ–¹æ³•å®Œæˆå¯¹è±¡çš„åˆ›å»ºï¼Œæ¯”è¾ƒéº»çƒ¦ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ `GenerateAllSetter` æ’ä»¶ä¸€é”®ç”Ÿæˆ
![[Pasted image 20231202164712.png]]
![[Pasted image 20231202165025.png]]
- <mark style="background: #ABF7F7A6;">MyBatis-Plus è‡ªåŠ¨ä¼šå°†é©¼å³°è½¬ä¸ºä¸‹åˆ’çº¿ï¼Œå¦‚æœæ•°æ®è¡¨ä¸­çš„å­—æ®µæ˜¯é©¼å³°å‘½åçš„è¯é‚£å°±ä¼šæŠ¥é”™ï¼Œæ‰€ä»¥åœ¨ä½¿ç”¨ MyBatis-Plus æ—¶å»ºè®®å°†è¡¨ä¸­çš„å­—æ®µè®¾ç½®ä¸ºä¸‹åˆ’çº¿æ ¼å¼ï¼Œæˆ–è€…åœ¨é…ç½®æ–‡ä»¶ä¸­å°† MaBatis-Plus çš„è‡ªåŠ¨è½¬æ¢å…³é—­</mark>
```yaml
mybatis-plus: #å°†MyBatis-Plusè‡ªåŠ¨è½¬æ¢é©¼å³°å…³é—­  
  configuration:  
    map-underscore-to-camel-case: false
```
3. å†™æ³¨å†Œé€»è¾‘
- ç”¨æˆ·åœ¨å‰ç«¯è¾“å…¥è´¦æˆ·å’Œå¯†ç ä»¥åŠæ ¡éªŒç /æ‰‹æœºéªŒè¯ç  (todo)
- æ ¡éªŒç”¨æˆ·çš„è´¦æˆ·ã€å¯†ç æ˜¯å¦ç¬¦åˆè¦æ±‚
	- è´¦æˆ·**ä¸å°äº** 4 ä½
	- å¯†ç **ä¸å°äº** 8 ä½
	- è´¦æˆ·ä¸èƒ½é‡å¤
	- è´¦æˆ·ä¸åŒ…å«ç‰¹æ®Šå­—ç¬¦
	- å¯†ç å’Œæ ¡éªŒå¯†ç ç›¸åŒ
	- å…¶ä»–æ ¡éªŒ
- å¯¹å¯†ç è¿›è¡ŒåŠ å¯†ï¼Œ<mark style="background: #FF5582A6;">å¯†ç åƒä¸‡ä¸èƒ½æ˜æ–‡å­˜å‚¨åˆ°æ•°æ®åº“ä¸­</mark>
- å‘æ•°æ®åº“æ’å…¥ç”¨æˆ·æ•°æ®

> [!NOTE]- UserService-ç”¨æˆ·æ³¨å†Œ
```java
public interface UserService extends IService<User> {  
    /**  
     * ç”¨æˆ·æ³¨å†Œ  
     * @param userAccount ç”¨æˆ·è´¦æˆ·  
     * @param userPassword ç”¨æˆ·å¯†ç   
     * @param checkPassword ç”¨æˆ·æ ¡éªŒå¯†ç   
     * @return ç”¨æˆ·id  
     */    long userRegister(String userAccount,String userPassword,String checkPassword);  
  
}
```

æˆ‘ä»¬åœ¨è¿›è¡Œç”¨æˆ·æ³¨å†Œæ ¡éªŒæ—¶ç»å¸¸ä¼šç”¨åˆ°éç©ºåˆ¤æ–­ï¼Œé•¿åº¦åˆ¤æ–­ç­‰æ ¡éªŒï¼Œå†™å‡ºæ¥çš„æ¡ä»¶åˆ¤æ–­éƒ½æ¯”è¾ƒå†—ä½™ï¼Œæˆ‘ä»¬å¯ä»¥å¼•å…¥ `apache commons util` å¸®åŠ©æˆ‘ä»¬è¿›è¡Œå­—ç¬¦ä¸²æ¡ä»¶åˆ¤æ–­
```xml
<!-- https://mvnrepository.com/artifact/org.apache.commons/commons-lang3 -->
<dependency>
    <groupId>org.apache.commons</groupId>
    <artifactId>commons-lang3</artifactId>
    <version>3.12.0</version>
</dependency>
```

> [!NOTE]- UserServiceImpl-ç”¨æˆ·æ³¨å†Œå®ç°
```java
@Override  
public long userRegister(String userAccount, String userPassword, String checkPassword) {  
    //1. æ ¡éªŒ  
    if(StringUtils.isAnyBlank(userAccount,userPassword,checkPassword)){//æ ¡éªŒæ‰€å«å­—ç¬¦ä¸²æ˜¯å¦ä¸ºç©ºï¼Œæˆ–è€…é•¿åº¦ä¸º0  
        return -1;  
    }  
    if(userAccount.length()<4){  
        return -1;  
    }  
    if(userPassword.length()<8||checkPassword.length()<8){  
        return -1;  
    }  
    //æ ¡éªŒè´¦æˆ·ä¸èƒ½åŒ…å«ç‰¹æ®Šå­—ç¬¦  
    String regEx = "\\pP|\\pS|\\s+";  
    Matcher matcher = Pattern.compile(regEx).matcher(userAccount);  
    if(matcher.find()){//åŒ¹é…åˆ°ç‰¹æ®Šå­—ç¬¦  
        return -1;  
    }  
    if(!userPassword.equals(checkPassword)){  
        return -1;  
    }  
    //è´¦æˆ·ä¸èƒ½é‡å¤ï¼ŒæŸ¥è¯¢æ•°æ®åº“ä¸­æœ‰æ²¡æœ‰ç›¸åŒçš„è´¦æˆ·,å¯ä»¥å°†æŸ¥è¯¢æ•°æ®åº“æ”¾åˆ°æœ€åï¼Œå¦‚æœå‰é¢çš„æ¡ä»¶éƒ½æ»¡è¶³çš„è¯ï¼Œåœ¨è¿›è¡ŒæŸ¥è¯¢æ•°æ®åº“ï¼Œå› ä¸ºæŸ¥è¯¢æ•°æ®åº“æ˜¯æœ€è€—è´¹æ—¶é—´çš„  
    long count = userMapper.selectCount(new QueryWrapper<User>().eq("userAccount", userAccount));  
    if(count>0){  
        return -1;  
    }  
    //2. å¯¹å¯†ç è¿›è¡ŒåŠ å¯†  
    final String SALT="yhk";//åŠ ç›  
    String encryptPassword = DigestUtils.md5DigestAsHex((SALT + userPassword).getBytes());  
    // 3.æ’å…¥æ•°æ®  
    User user=new User();  
    user.setUserAccount(userAccount);  
    user.setPassword(encryptPassword);  
    boolean saveResult = this.save(user);  
    if(!saveResult){  
        return -1;  
    }  
    return user.getId();//idä¸ºLongç±»å‹ï¼Œä½†æ˜¯è¿”å›çš„æ˜¯longç±»å‹ï¼Œå¦‚æœè¿”å›ä¸€ä¸ªnullçš„è¯å°†ä¼šæŠ¥é”™  
}
```

> [!warning]- æ³¨æ„
> - å­—ç¬¦ä¸²éç©ºæ ¡éªŒå°½é‡ä½¿ç”¨ `StringUtils` å·¥å…·ç±»
> - åŒ…å«ç‰¹æ®Šå­—ç¬¦ä¸²çš„æ­£åˆ™è¡¨è¾¾å¼ `"\\pP|\\pS|\\s+"`ï¼Œä½¿ç”¨ Matcher. Find () åˆ¤æ–­å­—ç¬¦ä¸²æ˜¯å¦åŒ¹é…
> - å¯¹å¯†ç è¿›è¡Œ md 5 åŠ å¯†è¦åŠ ç›ï¼Œæ‰€è°“åŠ ç›å°±æ˜¯åœ¨è¿›è¡ŒåŠ å¯†çš„æ—¶å€™å˜å¾—æ›´å¤æ‚ï¼Œå¯ä»¥ä½¿ç”¨ Spring æ¡†æ¶è‡ªå¸¦çš„åŠ å¯†å·¥å…· `DigestUtils.md5DigestAsHex()`
> - åœ¨å¯¹å‰ç«¯ä¿¡æ¯è¿›è¡Œæ ¡éªŒæ—¶ï¼Œå°½é‡å°†æ“ä½œæ•°æ®åº“çš„æ“ä½œæ”¾åˆ°æœ€åï¼Œæœ‰æ—¶å¯ä»¥é¿å…è¿›è¡Œæ“ä½œæ•°æ®åº“ï¼Œå› ä¸ºæ“ä½œæ•°æ®åº“æ˜¯æ¯”è¾ƒè€—æ—¶çš„
> - è¦æ³¨æ„è¿”å›ç±»å‹æ˜¯ä¸€ä¸ªåŒ…è£…ç±»ï¼Œé‚£ä¹ˆå°±æœ‰å¯èƒ½ä¸ºç©ºï¼Œä¸ºç©ºå°±ä¸èƒ½è¿›è¡Œæ‹†ç®±æ“ä½œï¼Œå°±ä¼šæŠ¥é”™ï¼Œæ‰€ä»¥å°½é‡å¯¹ç»“æœè¿›è¡Œè½¬æ¢

4. å†™ç™»å½•é€»è¾‘
- æ¥æ”¶å‚æ•°ï¼šç”¨æˆ·è´¦æˆ·, å¯†ç 
- è¿”å›å€¼ï¼šç”¨æˆ·ä¿¡æ¯ (**è„±æ•**)
- è¯·æ±‚ç±»å‹ï¼šPOST è¯·æ±‚ï¼ˆè¯·æ±‚å‚æ•°å¾ˆé•¿æ—¶ï¼Œä¸å»ºè®®ç”¨ GET è¯·æ±‚ï¼‰
- è¯·æ±‚ä½“ï¼šjson æ ¼å¼

1. æ ¡éªŒç”¨æˆ·è´¦æˆ·å’Œå¯†ç æ˜¯å¦åˆæ³•
	1. è´¦æˆ·ä¸å°äº 4 ä½
	2. å¯†ç ä¸å°äº 8 ä½
	3. éç©º
	4. è´¦æˆ·ä¸åŒ…å«ç‰¹æ®Šå­—ç¬¦
2. æ ¡éªŒå¯†ç æ˜¯å¦è¾“å…¥æ­£ç¡®ï¼Œå’Œæ•°æ®åº“ä¸­çš„å¯†æ–‡å¯†ç è¿›è¡Œæ¯”è¾ƒ
3. è®°å½•ç”¨æˆ·ç™»å½•æ€ (session)ï¼Œå­˜åˆ°æœåŠ¡å™¨ä¸Š (SpringBoot æ¡†æ¶å°è£…çš„ Tomcat æœåŠ¡å™¨)
4. è¿”å›ç”¨æˆ·ä¿¡æ¯ (<mark style="background: #ABF7F7A6;">è„±ç¦»ç”¨æˆ·æ•æ„Ÿä¿¡æ¯</mark>)

<mark style="background: #FFB86CA6;">å¦‚ä½•çŸ¥é“å“ªä¸ªç”¨æˆ·ç™»å½•äº†ï¼Ÿ</mark>
- è¿æ¥æœåŠ¡å™¨åï¼Œå¾—åˆ°ä¸€ä¸ª session çŠ¶æ€ï¼Œè¿”å›ç»™å‰ç«¯
- ç™»é™†æˆåŠŸåï¼Œå¾—åˆ°ç™»å½•æˆåŠŸçš„ session, è¿”å›ç»™å‰ç«¯ä¸€ä¸ªè®¾ç½® cookie çš„å‘½ä»¤
- å‰ç«¯æ¥æ”¶åˆ°åç«¯çš„å‘½ä»¤åï¼Œè®¾ç½® cookie, ä¿å­˜åˆ°æµè§ˆå™¨å†…
- å‰ç«¯å†æ¬¡è¯·æ±‚ç›¸åŒæœåŠ¡å™¨æ—¶ï¼Œåœ¨è¯·æ±‚å¤´ä¸­æºå¸¦ cookie å»è¯·æ±‚
- åç«¯æ‹¿åˆ°å‰ç«¯ä¼ æ¥çš„ cookie, æ‰¾åˆ°å¯¹åº”çš„ session
- åç«¯ä» session ä¸­å¯ä»¥å–å‡ºåŸºäºè¯¥ session å­˜å‚¨çš„å˜é‡


> [!NOTE] UserService-ç”¨æˆ·ç™»å½•
```java
/**  
 * è¿”å›è„±æ•åçš„ç”¨æˆ·ä¿¡æ¯  
 * @param userAccount ç”¨æˆ·è´¦æˆ·  
 * @param userPassword ç”¨æˆ·å¯†ç   
 * @return  
 */  
User doLogin (String userAccount, String userPassword, HttpServletRequest request);
```

> [!warning]- é€»è¾‘åˆ é™¤
> è¦åœ¨ MyBatis-Plus ä¸­å£°æ˜é€»è¾‘åˆ é™¤å­—æ®µï¼Œæ‰€è°“é€»è¾‘åˆ é™¤å°±æ˜¯ç”¨æˆ·æŸ¥è¯¢ä¸åˆ°ï¼Œä½†æ˜¯æ•°æ®ä¿ç•™åœ¨æ•°æ®åº“ä¸­ï¼Œæ¯”å¦‚åœ¨ç”¨æˆ·ç™»å½•è¿‡ç¨‹ä¸­æ ¹æ®è´¦æˆ·è¿›è¡ŒæŸ¥è¯¢ä¿¡æ¯ï¼Œå¦‚æœè´¦æˆ·ä¹‹å‰å·²ç»åˆ é™¤ï¼Œæ ‡è®°ä¸ºé€»è¾‘åˆ é™¤ï¼Œé‚£å°†æŸ¥è¯¢å¤±è´¥

- æ·»åŠ å…¨å±€é€»è¾‘åˆ é™¤, æ·»åŠ é…ç½®ä¿¡æ¯
```yaml
Mybatis-plus:
	Global-config:  
	  Db-config:  
	    logic-delete-field: flag #å…¨å±€é€»è¾‘åˆ é™¤çš„å®ä½“å­—æ®µå  
	    logic-delete-value: 1 #é€»è¾‘åˆ é™¤é»˜è®¤å€¼  
	    logic-not-delete-value: 0 #é€»è¾‘æœªåˆ é™¤é»˜è®¤å€¼
```
- åœ¨ User å®ä½“ç±»çš„é€»è¾‘åˆ é™¤å­—æ®µä¸ŠåŠ  `@TableLogic` æ³¨è§£
```java
@TableLogic  
Private Integer idDelete;
```

> [!NOTE] UserServiceImpl-ç”¨æˆ·ç™»å½•
```java
@Override  
Public User doLogin (String userAccount, String userPassword, HttpServletRequest request) {  
    //æ ¡éªŒ  
    If (StringUtils.IsAnyBlank (userAccount, userPassword)){  
        Return null;  
    }  
    If (userAccount.Length ()<4){  
        Return null;  
    }  
    If (userPassword.Length ()<8){  
        Return null;  
    }  
    //è´¦æˆ·ä¸èƒ½åŒ…å«ç‰¹æ®Šå­—ç¬¦  
    String regEx = "\\pP|\\pS|\\s+";  
    Matcher matcher = Pattern.Compile (regEx). Matcher (userAccount);  
    If (matcher.Find ()){  
        Return null;  
    }  
    //å°†ç™»å½•çš„å¯†ç è¿›è¡ŒåŠ å¯†ï¼Œç„¶åä¸æ•°æ®åº“ä¸­çš„å¯†ç è¿›è¡Œå¯¹æ¯”  
    String entryPassword=DigestUtils. Md 5 DigestAsHex ((SALT+userPassword). GetBytes ());  
    //æ ¹æ®è´¦æˆ·å’Œå¯†ç æŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯  
    QueryWrapper<User> queryWrapper=new QueryWrapper<>();  
    QueryWrapper.Eq ("userAccount", userAccount);  
    QueryWrapper.Eq ("userPassword", entryPassword);  
    User user = userMapper.SelectOne (queryWrapper);  
    //ç”¨æˆ·ä¸å­˜åœ¨  
    If (user==null){  
        Log.Info ("user login failed, userAccount cannot match userPassword");  
        Return null;  
    }  
    //ç”¨æˆ·è„±æ•  
    User safeUser=new User ();  
    SafeUser.SetId (user.GetId ());  
    SafeUser.SetUsername (user.GetUsername ());  
    SafeUser.SetUserAccount (user.GetUserAccount ());  
    SafeUser.SetAvatarUrl (user.GetAvatarUrl ());  
    SafeUser.SetGender (user.GetGender ());  
    SafeUser.SetPhone (user.GetPhone ());  
    SafeUser.SetEmail (user.GetEmail ());  
    SafeUser.SetStatus (user.GetStatus ());  
    SafeUser.SetCreateTime (user.GetCreateTime ());  
    //è®°å½•ç”¨æˆ·ç™»å½•æ€  
    Request.GetSession (). SetAttribute (USER_LOGIN_STATUS, safeUser);  
    Return safeUser;  
}
```

> [!warning]- æ³¨æ„
> - å¯ä»¥å°†ç”¨äºåŠ å¯†çš„ç›å’Œç”¨æˆ· session çš„é”®è®¾ç½®ä¸ºå¸¸é‡
> - å¿…é¡»è¦è¿›è¡Œç”¨æˆ·è„±æ•ï¼Œä¸èƒ½å°†ç”¨æˆ·çš„ä¸€äº›æ•æ„Ÿä¿¡æ¯è¿”å›ç»™å‰ç«¯
> - Lombok æ’ä»¶ä¸­çš„ `@Slf 4 j` æ³¨è§£ç”¨äºæä¾›æ—¥å¿—åŠŸèƒ½

`@RestController` é€‚ç”¨äºç¼–å†™ restful é£æ ¼çš„ api, è¿”å› json ç±»å‹çš„æ•°æ®
- åœ¨è°ƒç”¨ä¸€ä¸ªæ–¹æ³•æ—¶ï¼Œå¾€å¾€éœ€è¦æ‰‹åŠ¨çš„è¾“å…¥å‚æ•°ï¼Œæ¯”è¾ƒéº»çƒ¦ï¼Œæ¨èå®‰è£… `Auto Filling Java Call Arguments` æ’ä»¶ï¼Œè‡ªåŠ¨å¡«å……å‚æ•°
![[Pasted image 20231205185652.png]]
- è¯·æ±‚ä½“ä½ json æ ¼å¼ï¼Œæˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸€ä¸ªå¯¹è±¡ä¸“é—¨æ¥æ¥æ”¶ json æ ¼å¼çš„æ•°æ®è¯·æ±‚
```java
@Data  
Public class UserRegisterRequest implements Serializable {  
    Private String userAccount;  
    Private String userPassword;  
    Private String checkPassword;  
}
```

- Controller å±‚æ˜¯å¯¹è¯·æ±‚å‚æ•°çš„æ ¡éªŒï¼Œä¸æ¶‰åŠä¸šåŠ¡é€»è¾‘ï¼ŒService å±‚æ˜¯å¯¹ä¸šåŠ¡é€»è¾‘çš„æ ¡éªŒ

> [!NOTE] UserController
```java
@RestController  
@RequestMapping ("/user")  
Public class UserController {  
    @Resource  
    Private UserService userService;  
    @PostMapping ("/register")  
    Public Long userRegister (@RequestBody UserRegisterRequest userRegisterRequest){  
        If (userRegisterRequest==null){  
            Return null;  
        }  
        String userAccount = userRegisterRequest.GetUserAccount ();  
        String userPassword = userRegisterRequest.GetUserPassword ();  
        String checkPassword = userRegisterRequest.GetCheckPassword ();  
        If (StringUtils.IsAnyBlank (userAccount, userPassword, checkPassword)) {  
            Return null;  
        }  
        Return userService.UserRegister (userAccount, userPassword, checkPassword);  
    }  
  
    @PostMapping ("/login")  
    Public User userRegister (@RequestBody UserLoginRequest userLoginRequest, HttpServletRequest request){  
        If (userLoginRequest==null){  
            Return null;  
        }  
        String userAccount = userLoginRequest.GetUserAccount ();  
        String userPassword = userLoginRequest.GetUserPassword ();  
        If (StringUtils.IsAnyBlank (userAccount, userPassword)) {  
            Return null;  
        }  
        Return userService.UserLogin (userAccount, userPassword, request);  
    }  
}
```


> [!NOTE]- æµ‹è¯•
> æˆ‘è‰ï¼Œapifox å´©äº†ï¼Œå®³æˆ‘æµ‹è¯•äº†å¥½ä¸€é˜µå­ğŸ˜­
![[Pasted image 20231205214707.png]]
![[Pasted image 20231205214737.png]]



### ç”¨æˆ·ç®¡ç†æ¥å£-åç«¯
1. æŸ¥è¯¢ç”¨æˆ·
	1. æ ¹æ®ç”¨æˆ·åæŸ¥è¯¢
2. åˆ é™¤ç”¨æˆ·

> [!NOTE] UserController-ç”¨æˆ·æŸ¥è¯¢æ¥å£
```java
@GetMapping ("/search")  
 public List<User> searchUsers (String username){  
	 //é‰´æƒï¼Œä»…ç®¡ç†å‘˜å¯ä»¥æŸ¥è¯¢  
	Object userObj = request.GetSession (). GetAttribute (USER_LOGIN_STATUS);  
	User user = (User) userObj;  
	If (user==null||user.GetRole ()!=ADMIN_ROLE){  
	    return new ArrayList<>();  
	}
     Return userService.SearchUsers (username);  
 }
 
```

> [!NOTE] UserServiceImpl-ç”¨æˆ·æŸ¥è¯¢
```java
@Override  
public List<User> searchUsers (String username) {  
    QueryWrapper<User> queryWrapper = new QueryWrapper<>();  
    If (StringUtils.IsNotBlank (username)) {  
        QueryWrapper.Like ("username", username);  
    }  
    Return this.List (queryWrapper);  
}
```

> [!NOTE] UserController-ç”¨æˆ·åˆ é™¤æ¥å£
```java
@PostMapping ("delete")  
Public boolean deleteUser (@RequestBody long id,, HttpServletRequest request){
	//é‰´æƒï¼Œä»…ç®¡ç†å‘˜å¯ä»¥æŸ¥è¯¢  
	Object userObj = request.GetSession (). GetAttribute (USER_LOGIN_STATUS);  
	User user = (User) userObj;  
	If (user==null||user.GetRole ()!=ADMIN_ROLE){  
	    Return false;  
	}
    If (id<=0){  
        Return false;  
    }  
    Return userService.RemoveById (id);  
}
```


> [!warning] æ³¨æ„
> ä¸€å®šè¦è¿›è¡Œé‰´æƒï¼Œæœ‰äº›æ¥å£åªèƒ½ç®¡ç†å‘˜è¿›è¡Œè°ƒç”¨ï¼Œä¸èƒ½è®©ä¸€äº›é˜¿çŒ«é˜¿ç‹—æ¶æ„è°ƒç”¨

- åœ¨ user è¡¨ä¸­æ·»åŠ ä¸€ä¸ª<mark style="background: #FF5582A6;">èº«ä»½</mark>å­—æ®µï¼ŒåŒºåˆ†æ™®é€šç”¨æˆ·ä¸ç®¡ç†å‘˜
- åªèƒ½ç®¡ç†å‘˜èƒ½åˆ é™¤ç”¨æˆ·å’ŒæŸ¥è¯¢ç”¨æˆ·
- æ³¨æ„ï¼šæ·»åŠ ä¸€ä¸ªå­—æ®µåè¦åœ¨å¯¹ç”¨çš„å®ä½“ç±»ä¸Šä¹Ÿæ·»åŠ ä¸€ä¸ªå±æ€§, å°½é‡ä¸è¦æ‰‹åŠ¨æ·»åŠ ï¼Œå› ä¸ºæ‰‹åŠ¨æ·»åŠ è¿˜è¦ä¿®æ”¹ mapper æ˜ å°„æ–‡ä»¶ï¼Œ<mark style="background: #ABF7F7A6;">å»ºè®®é‡æ–°ç”¨ MyBatisX ç”Ÿæˆä»£ç </mark>
<mark style="background: #FF5582A6;">æˆ‘ä»¬å¯ä»¥å°†ç”¨æˆ·ä½¿ç”¨åˆ°çš„å¸¸é‡å°è£…åœ¨ä¸€ä¸ªå¸¸é‡ç±»ä¸­</mark>
- æ–°å»ºä¸€ä¸ªå¸¸é‡åŒ… `constant`, åˆ›å»º `UserConatant` æ¥å£ï¼Œä¸ºä»€ä¹ˆåˆ›å»ºæ¥å£ï¼Œå› ä¸ºæ¥å£ä¸­çš„å˜é‡é»˜è®¤ä¸ºå¸¸é‡
```java
Public interface UserConstant {  
    /**  
     * ç”¨æˆ·ç™»å½•é”®  
     */  
    String USER_LOGIN_STATUS = "userLoginStatus";  
    /**  
     * é»˜è®¤æƒé™  
     */  
    Int DEFAULT_ROLE=0;  
    /**  
     * ç®¡ç†å‘˜æƒé™  
     */  
    Int ADMIN_ROLE=1;  
}
```

<mark style="background: #ABF7F7A6;">æˆ‘ä¹ˆå¯ä»¥å°†ç”¨æˆ·èº«ä»½æ ¡éªŒå°è£…æˆä¸€ä¸ªå•ç‹¬çš„æ–¹æ³•è¿›è¡Œåˆ¤æ–­ï¼Œå¦åˆ™ååºå¦‚æœè¿˜è¦è¿›è¡Œèº«ä»½æ ¡éªŒçš„è¯ï¼Œåˆéœ€è¦é‡æ–°å†™ä¸€éï¼Œä»£ç æ˜¯åœ¨å†—ä½™</mark>

> [!NOTE] UserController
```java
@RestController  
@RequestMapping ("/user")  
Public class UserController {  
    @Resource  
    Private UserService userService;  
    @PostMapping ("/register")  
    Public Long userRegister (@RequestBody UserRegisterRequest userRegisterRequest){  
        If (userRegisterRequest==null){  
            Return null;  
        }  
        String userAccount = userRegisterRequest.GetUserAccount ();  
        String userPassword = userRegisterRequest.GetUserPassword ();  
        String checkPassword = userRegisterRequest.GetCheckPassword ();  
        If (StringUtils.IsAnyBlank (userAccount, userPassword, checkPassword)) {  
            Return null;  
        }  
        Return userService.UserRegister (userAccount, userPassword, checkPassword);  
    }  
  
    @PostMapping ("/login")  
    Public User userRegister (@RequestBody UserLoginRequest userLoginRequest, HttpServletRequest request){  
        If (userLoginRequest==null){  
            Return null;  
        }  
        String userAccount = userLoginRequest.GetUserAccount ();  
        String userPassword = userLoginRequest.GetUserPassword ();  
        If (StringUtils.IsAnyBlank (userAccount, userPassword)) {  
            Return null;  
        }  
        Return userService.UserLogin (userAccount, userPassword, request);  
    }  
  
   @GetMapping ("/search")  
    public List<User> searchUsers (@RequestBody String username, HttpServletRequest request){  
        //é‰´æƒï¼Œä»…ç®¡ç†å‘˜å¯ä»¥æŸ¥è¯¢  
       If (! IsAdmin (request)){  
           return new ArrayList<>();  
       }  
       Return userService.SearchUsers (username);
    }  
  
    @PostMapping ("delete")  
    Public boolean deleteUser (@RequestBody long id, HttpServletRequest request){  
        If (! IsAdmin (request)){  
            Return false;  
        }  
        If (id<=0){  
            Return false;  
        }  
        Return userService.RemoveById (id);  
    }  
  
    /**  
     * æ˜¯å¦ä¸ºç®¡ç†å‘˜  
     * @param request  
     * @return  
     */  
    Private boolean isAdmin (HttpServletRequest request){  
        //é‰´æƒï¼Œä»…ç®¡ç†å‘˜å¯ä»¥æŸ¥è¯¢  
        Object userObj = request.GetSession (). GetAttribute (USER_LOGIN_STATUS);  
        User user = (User) userObj;  
        If (user==null||user.GetRole ()!=ADMIN_ROLE){  
            Return false;  
        }  
        Return true;  
    }  
}
```

<mark style="background: #ABF7F7A6;">æˆ‘ä»¬è¿”å›ç»™å‰ç«¯çš„ç”¨æˆ·ä¿¡æ¯å§‹ç»ˆä¸ºè„±æ•çš„ç”¨æˆ·ä¿¡æ¯ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥åœ¨ service å±‚ç¼–å†™ä¸€ä¸ªæ–¹æ³•ä¸“é—¨ç”¨äºå¯¹åŸç”Ÿç”¨æˆ·ä¿¡æ¯è¿›è¡Œè„±æ•</mark>

> [!NOTE] UserServiceImpl
```java
@Service  
@Slf 4 j  
public class UserServiceImpl extends ServiceImpl<UserMapper, User>  
    Implements UserService {  
    @Resource  
    Private UserMapper userMapper;  
    Private static final String SALT="yhk";//åŠ ç›, æ··æ·†å¯†ç   
  
    @Override  
    Public long userRegister (String userAccount, String userPassword, String checkPassword) {  
        //1. æ ¡éªŒ  
        If (StringUtils.IsAnyBlank (userAccount, userPassword, checkPassword)){//æ ¡éªŒæ‰€å«å­—ç¬¦ä¸²æ˜¯å¦ä¸ºç©ºï¼Œæˆ–è€…é•¿åº¦ä¸º 0  
            Return -1;  
        }  
        If (userAccount.Length ()<4){  
            Return -1;  
        }  
        If (userPassword.Length ()<8||checkPassword.Length ()<8){  
            Return -1;  
        }  
        //æ ¡éªŒè´¦æˆ·ä¸èƒ½åŒ…å«ç‰¹æ®Šå­—ç¬¦  
        String regEx = "\\pP|\\pS|\\s+";  
        Matcher matcher = Pattern.Compile (regEx). Matcher (userAccount);  
        If (matcher.Find ()){//åŒ¹é…åˆ°ç‰¹æ®Šå­—ç¬¦  
            Return -1;  
        }  
        If (! UserPassword.Equals (checkPassword)){  
            Return -1;  
        }  
        //è´¦æˆ·ä¸èƒ½é‡å¤ï¼ŒæŸ¥è¯¢æ•°æ®åº“ä¸­æœ‰æ²¡æœ‰ç›¸åŒçš„è´¦æˆ·, å¯ä»¥å°†æŸ¥è¯¢æ•°æ®åº“æ”¾åˆ°æœ€åï¼Œå¦‚æœå‰é¢çš„æ¡ä»¶éƒ½æ»¡è¶³çš„è¯ï¼Œåœ¨è¿›è¡ŒæŸ¥è¯¢æ•°æ®åº“ï¼Œå› ä¸ºæŸ¥è¯¢æ•°æ®åº“æ˜¯æœ€è€—è´¹æ—¶é—´çš„  
        long count = userMapper.SelectCount (new QueryWrapper<User>(). Eq ("userAccount", userAccount));  
        If (count>0){  
            Return -1;  
        }  
        //2. å¯¹å¯†ç è¿›è¡ŒåŠ å¯†  
        String encryptPassword = DigestUtils. Md 5 DigestAsHex ((SALT + userPassword). GetBytes ());  
        // 3. æ’å…¥æ•°æ®  
        User user=new User ();  
        User.SetUserAccount (userAccount);  
        User.SetPassword (encryptPassword);  
        Boolean saveResult = this.Save (user);  
        If (! SaveResult){  
            Return -1;  
        }  
        Return user.GetId ();//id ä¸º Long ç±»å‹ï¼Œä½†æ˜¯è¿”å›çš„æ˜¯ long ç±»å‹ï¼Œå¦‚æœè¿”å›ä¸€ä¸ª null çš„è¯å°†ä¼šæŠ¥é”™  
    }  
  
    @Override  
    Public User userLogin (String userAccount, String userPassword, HttpServletRequest request) {  
        //æ ¡éªŒ  
        If (StringUtils.IsAnyBlank (userAccount, userPassword)){  
            Return null;  
        }  
        If (userAccount.Length ()<4){  
            Return null;  
        }  
        If (userPassword.Length ()<8){  
            Return null;  
        }  
        //è´¦æˆ·ä¸èƒ½åŒ…å«ç‰¹æ®Šå­—ç¬¦  
        String regEx = "\\pP|\\pS|\\s+";  
        Matcher matcher = Pattern.Compile (regEx). Matcher (userAccount);  
        If (matcher.Find ()){  
            Return null;  
        }  
        //å°†ç™»å½•çš„å¯†ç è¿›è¡ŒåŠ å¯†ï¼Œç„¶åä¸æ•°æ®åº“ä¸­çš„å¯†ç è¿›è¡Œå¯¹æ¯”  
        String entryPassword=DigestUtils. Md 5 DigestAsHex ((SALT+userPassword). GetBytes ());  
        //æ ¹æ®è´¦æˆ·å’Œå¯†ç æŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯  
        QueryWrapper<User> queryWrapper=new QueryWrapper<>();  
        QueryWrapper.Eq ("userAccount", userAccount);  
        QueryWrapper.Eq ("password", entryPassword);  
        User user = userMapper.SelectOne (queryWrapper);  
        //ç”¨æˆ·ä¸å­˜åœ¨  
        If (user==null){  
            Log.Info ("user login failed, userAccount cannot match userPassword");  
            Return null;  
        }  
        //ç”¨æˆ·è„±æ•  
        User safeUser = getSafeUser (user);  
        //è®°å½•ç”¨æˆ·ç™»å½•æ€  
        Request.GetSession (). SetAttribute (USER_LOGIN_STATUS, safeUser);  
        Return safeUser;  
    }  
  
    @Override  
    public List<User> searchUsers (String username) {  
        QueryWrapper<User> queryWrapper = new QueryWrapper<>();  
        If (StringUtils.IsNotBlank (username)) {  
            QueryWrapper.Like ("username", username);  
        }  
        List<User> userList= this.List (queryWrapper);  
        Return userList.Stream (). Map (user -> getSafeUser (user)). Collect (Collectors.ToList ());  
    }  
  
    /**  
     * å°†åŸç”Ÿ user å¯¹è±¡è¿›è¡Œè„±æ•  
     * @param originUser åŸç”Ÿ user  
     * @return  
     */  
    @Override  
    Public User getSafeUser (User originUser) {  
        User safeUser=new User ();  
        SafeUser.SetId (originUser.GetId ());  
        SafeUser.SetUsername (originUser.GetUsername ());  
        SafeUser.SetUserAccount (originUser.GetUserAccount ());  
        SafeUser.SetAvatarUrl (originUser.GetAvatarUrl ());  
        SafeUser.SetGender (originUser.GetGender ());  
        SafeUser.SetPhone (originUser.GetPhone ());  
        SafeUser.SetEmail (originUser.GetEmail ());  
        SafeUser.SetStatus (originUser.GetStatus ());  
        SafeUser.SetCreateTime (originUser.GetCreateTime ());  
        Return safeUser;  
    }  
}
```

> [!warning]- æ³¨æ„
>- ä½†å‡¡æ˜¯è¿”å›ç»™å‰ç«¯ç”¨æˆ·ä¿¡æ¯ï¼Œä¸€å®šè¦è¿›è¡Œè„±æ•
>- ç”¨æˆ·åŠŸèƒ½ä¸­ç”¨åˆ°çš„å¸¸é‡å¯ä»¥å°è£…ä¸ºä¸€ä¸ªæ¥å£
>- åœ¨å¤šä¸ªæ¥å£ä¸­ç”¨åˆ°åŒæ ·ä»£ç å—ï¼Œå¯ä»¥å°†ä»£ç å—å°è£…ä¸ºä¸€ä¸ªæ–¹æ³•ï¼Œå®ç°åŠŸèƒ½å¤ç”¨
>- ä¸€äº›æ¥å£åªèƒ½ç®¡ç†å‘˜è¿›è¡Œè°ƒç”¨ï¼Œå¿…é¡»è¿›è¡Œé‰´æƒï¼ˆå¯ä»¥å°†é‰´æƒæ“ä½œå°è£…ä¸ºä¸€ä¸ªæ–¹æ³•ï¼‰
>- å¯ä»¥ä½¿ç”¨ java 8 ä¸­çš„ stream æµï¼Œä½¿ä»£ç æ›´ä¼˜é›…ğŸ˜

### ç™»å½•æ³¨å†Œ-å‰ç«¯
- å¦‚æœå¯¹å‰ç«¯ä¸æ„Ÿå…´è¶£ï¼Œå¯ä»¥ç›´æ¥å°†å‰ç«¯æ–‡ä»¶éƒ¨ç½²åœ¨ WebStrom ä¸Šï¼Œä¸è¿‡è¦æ³¨æ„ï¼Œ<mark style="background: #ABF7F7A6;">nodejs çš„ç‰ˆæœ¬ä¸€å®šè¦æ˜¯ 16</mark>,nodejs 16 ç‰ˆæœ¬ç°åœ¨å·²ç»ä¸æ”¯æŒäº†ï¼Œä½†å¯ä»¥é€šè¿‡ nvm ç®¡ç†åº“è¿›è¡Œå®‰è£…
- ä¿®æ”¹ç™»å½•ç•Œé¢åº•éƒ¨ 
```js
Import { GithubOutlined } from '@ant-design/icons';  
Import { DefaultFooter } from '@ant-design/pro-layout';  
Import { PLANET_LINK } from '@/constants';  
  
Const Footer: React. FC = () => {  
  Const defaultMessage = 'Moresuo å‡ºå“';  
  Const currentYear = new Date (). GetFullYear ();  
  Return (  
    <DefaultFooter  
      Copyright={`${currentYear} ${defaultMessage}`}  
      Links={[  
        {  
          Key: 'planet',  
          Title: 'çŸ¥è¯†æ˜Ÿçƒ',  
          Href: PLANET_LINK,  
          BlankTarget: true,  
        },  
        {  
          Key: 'codeNav',  
          Title: 'ç¼–ç¨‹å¯¼èˆª',  
          href: ' https://www.code-nav.cn ',  
          BlankTarget: true,  
        },  
        {  
          Key: 'github',  
          Title: (  
            <>  
              <GithubOutlined /> Moresuo GitHub  
            </>  
          ),  
          href: ' https://github.com/moresuo ',  
          BlankTarget: true,  
        },  
      ]}  
    />  
  );  
};  
  
Export default Footer;
```
- å°† logo å›¾ç‰‡è®¾ç½®ä¸ºå¸¸é‡
### è·å–å½“å‰ç”¨æˆ·ä¿¡æ¯æ¥å£
ç›¸å½“äºä¸€ä¸ªæ‹¦æˆªçš„åŠŸèƒ½ï¼Œå½“è·³è½¬å…¶ä»–é¡µé¢æ—¶ï¼Œè¯·æ±‚è¿™ä¸ªæ¥å£ï¼Œå¦‚æœç”¨æˆ·çŠ¶æ€ä¸ºç©ºï¼Œè¯´æ˜è¿˜æ²¡æœ‰ç™»å½•ï¼Œç›´æ¥è¿”å›ç™»å½•é¡µé¢

> [!NOTE] UserController-ç”¨æˆ·ä¿¡æ¯æ¥å£
```java
@GetMapping ("/current")  
Public User getCurrentUser (HttpServletRequest request){  
    Object userObj = request.GetSession (). GetAttribute (USER_LOGIN_STATUS);  
    User userCurrent= (User) userObj;  
    If (userCurrent==null){  
        Return null;  
    }  
    //æ ¹æ®ç”¨æˆ· id å»æŸ¥è¯¢ç”¨æˆ·æ•°æ®åº“çš„å…·ä½“ä¿¡æ¯  
    Long userId = userCurrent.GetId ();  
    //todo æ ¡éªŒç”¨æˆ·æ˜¯å¦åˆæ³•  
    User user = userService.GetById (userId);  
    Return userService.GetSafeUser (user);  
}
```

> [!warning]- æ³¨æ„
> - ç”¨æˆ·ä¿¡æ¯éšæ—¶éƒ½å¯èƒ½ä¼šå˜ï¼Œå­˜æ”¾åœ¨ session ä¸­çš„ç”¨æˆ·ä¿¡æ¯ä¸å…·æœ‰åŠ¨æ€æ€§ï¼Œæ‰€ä»¥è¿˜è¦æ ¹æ®ç”¨æˆ· id å»æŸ¥è¯¢æ•°æ®åº“è¿”å›æœ€æ–°çš„ç”¨æˆ·ä¿¡æ¯

### ç”¨æˆ·æ³¨é”€ -åç«¯
- ç™»å½•æ—¶å°†ç”¨æˆ·çš„çŠ¶æ€å­˜å…¥ session ä¸­ï¼Œä½¿ç”¨æˆ·åœ¨è®¿é—®å…¶ä»–è¯·æ±‚æ—¶ä¿æŒç™»å½•çš„çŠ¶æ€ï¼Œè¿™ä¸€åˆ‡éƒ½å½’åŠŸä¸ session
- ç›¸åï¼Œå¦‚æœæƒ³è®©ç”¨æˆ·æ³¨é”€æ‰ï¼Œå¤±å»ç™»å½•çš„çŠ¶æ€ï¼Œæˆ‘ä»¬å°† session ä¸­çš„ç™»å½•ç”¨æˆ·ç§»é™¤å°±è¡Œäº†

> [!NOTE] UserService-logOut
```java
/**  
 * ç”¨æˆ·æ³¨é”€åŠŸèƒ½  
 * @return  
 */  
Int userLogout (HttpServletRequest request);
```

> [!NOTE]- UserServiceImpl-logOut
```java
@Override  
Public int userLogout (HttpServletRequest request) {  
    Request.GetSession (). RemoveAttribute (USER_LOGIN_STATUS);//å°†ç”¨æˆ·çŠ¶æ€ä» session ä¸­ç§»é™¤  
    Return 1;
}
```


> [!NOTE] UserController-logOut
```java
@PostMapping ("/logout")  
Public Integer userLogOut (HttpServletRequest request){  
    If (request==null){  
        Return null;  
    }    return userService.UserLogout (request);  
}
```

### ç”¨æˆ·æ ¡éªŒ
>ä»…é€‚ç”¨äºç”¨æˆ·å¯ä¿¡çš„æƒ…å†µ

å…ˆè®©ç”¨æˆ·è‡ªå·±å¡«ï¼š2-5 ä½æ˜Ÿçƒç¼–å·
åç«¯æ ¡éªŒï¼šé•¿åº¦æ ¡éªŒï¼Œå”¯ä¸€æ€§æ ¡éªŒ
å‰ç«¯è¡¥å……è¾“å…¥æ¡†ï¼Œé€‚é…åç«¯

- æ–°å¢ä¸€ä¸ªå­—æ®µ `planetCode`, é€šè¿‡ MyBatisX æ’ä»¶å†æ¬¡ç”Ÿæˆ User ç±»ï¼Œ<mark style="background: #ABF7F7A6;">å¹¶ä¿®æ”¹ UserMapper é…ç½®æ–‡ä»¶æ˜ å°„çš„åŒ…å</mark>
- æ˜Ÿçƒç¼–å·ä¸ç”¨æ•°æ®è„±æ•ï¼Œè¦è¿”å›ç»™å‰ç«¯
- æ–°å¢ä¸€ä¸ªå­—æ®µï¼Œä¹Ÿè¦ä¿®æ”¹ä¸€äº›åˆ—ä¸šåŠ¡ä»£ç ï¼Œå®åœ¨æ˜¯å¤ªéº»çƒ¦äº†ï¼Œåœ¨å®é™…å¼€å‘ä¸­å°½é‡ä¸è¦å»æ–°å¢æˆ–åˆ é™¤ä¸€ä¸ªå­—æ®µğŸ˜­
- åœ¨ UserServiceImpl ä¸­è¿˜è¦æ ¡éªŒæ˜Ÿçƒç¼–å·çš„å”¯ä¸€æ€§
```java
//æ˜Ÿçƒç¼–å·ä¸èƒ½é‡å¤  
count = userMapper.SelectCount (new QueryWrapper<User>(). Eq ("planetCode", planetCode));  
If (count>0){  
    Return -1;  
}
```

### åç«¯ä¼˜åŒ–
#### é€šç”¨è¿”å›å¯¹è±¡
ç›®çš„ï¼šç»™å¯¹è±¡è¡¥å……ä¸€äº›ä¿¡æ¯ï¼Œå‘Šè¯‰å‰ç«¯è¿™ä¸ªè¯·æ±‚åœ¨ä¸šåŠ¡ä¸Šæ˜¯æˆåŠŸè¿˜æ˜¯å¤±è´¥
```json
{
	"code": 0,//ä¸šåŠ¡çŠ¶æ€ç 
	"data":{
		//å…·ä½“è¿”å›çš„å¯¹è±¡æ•°æ®
	},
	"message": "è¿”å›ä¿¡æ¯"
}
```


> [!NOTE] BaseResponse
```java
Package com. Yhk. Usercenter. Common;  
  
Import lombok. Data;  
  
Import java. Io. Serializable;  
  
/**  
 * @version 1.0  
 * @Author moresuo  
 * @Date 2023/12/11 21:03  
 * @æ³¨é‡Šé€šç”¨è¿”å›ç±»  
 */  
@Data  
public class BaseResponse<T> implements Serializable {  
    Private static final long serialVersionUID = -7506108714914421400 L;  
    Private Integer code;  
    Private T data;  
    Private String message;  
  
    Public BaseResponse (Integer code, T data, String message) {  
        This. Code = code;  
        This. Data = data;  
        This. Message = message;  
    }  
  
    Public BaseResponse (Integer code, T data) {  
        This. Code = code;  
        This. Data = data;  
        This. Message="";  
    }  
  
}
```

ä¿®æ”¹ controller å±‚æ‰€æœ‰çš„è¿”å›å¯¹è±¡ä¸º `BaseResponse` è¿™æ ·çš„åšæ³•æ˜¯åœ¨å¤ªéº»çƒ¦äº†ï¼Œ<mark style="background: #ABF7F7A6;">å¯ä»¥åˆ›å»ºä¸€ä¸ªè¿”å›å·¥å…·ç±»ï¼Œå°†æˆåŠŸä¿¡æ¯å’Œå¤±è´¥ç­‰ä¿¡æ¯è¿›è¡Œå°è£…
</mark>

> [!NOTE] ResultUtil
```java
Public class ResultUtil {  
    public static <T> BaseResponse<T> success (T data){  
        return new BaseResponse<>(0, data,"ok");  
    }  
}
```


> [!NOTE] UserController
```java
Package com. Yhk. Usercenter. Controller;  
  
Import com. Yhk. Usercenter. Common. BaseResponse;  
Import com. Yhk. Usercenter. Common. ResultUtil;  
Import com. Yhk. Usercenter. Model. Domain. User;  
Import com. Yhk. Usercenter. Model. Request. UserLoginRequest;  
Import com. Yhk. Usercenter. Model. Request. UserRegisterRequest;  
Import com. Yhk. Usercenter. Service. UserService;  
Import org. Apache. Commons. Lang 3. StringUtils;  
Import org. Springframework. Web. Bind. Annotation.*;  
  
Import javax. Annotation. Resource;  
Import javax. Servlet. Http. HttpServletRequest;  
Import java. Util. ArrayList;  
Import java. Util. List;  
  
Import static com. Yhk. Usercenter. Constant. UserConstant. ADMIN_ROLE;  
Import static com. Yhk. Usercenter. Constant. UserConstant. USER_LOGIN_STATUS;  
  
/**  
 * @version 1.0  
 * @Author moresuo  
 * @Date 2023/12/5 18:48  
 * @æ³¨é‡Šç”¨æˆ·æ¥å£  
 */  
@RestController  
@RequestMapping ("/user")  
Public class UserController {  
    @Resource  
    Private UserService userService;  
    @PostMapping ("/register")  
    public BaseResponse<Long> userRegister (@RequestBody UserRegisterRequest userRegisterRequest){  
        If (userRegisterRequest==null){  
            Return null;  
        }        String userAccount = userRegisterRequest.GetUserAccount ();  
        String userPassword = userRegisterRequest.GetUserPassword ();  
        String checkPassword = userRegisterRequest.GetCheckPassword ();  
        String planetCode= userRegisterRequest.GetPlanetCode ();  
        If (StringUtils.IsAnyBlank (userAccount, userPassword, checkPassword, planetCode)) {  
            Return null;  
        }        long result = userService.UserRegister (userAccount, userPassword, checkPassword, planetCode);  
        Return ResultUtil.Success (result);  
    }  
  
    @PostMapping ("/login")  
    public BaseResponse<User> userRegister (@RequestBody UserLoginRequest userLoginRequest, HttpServletRequest request){  
        If (userLoginRequest==null){  
            Return null;  
        }        String userAccount = userLoginRequest.GetUserAccount ();  
        String userPassword = userLoginRequest.GetUserPassword ();  
        If (StringUtils.IsAnyBlank (userAccount, userPassword)) {  
            Return null;  
        }        User user = userService.UserLogin (userAccount, userPassword, request);  
        Return ResultUtil.Success (user);  
    }  
    @PostMapping ("/logout")  
    public BaseResponse<Integer> userLogOut (HttpServletRequest request){  
        If (request==null){  
            Return null;  
        }        int result = userService.UserLogout (request);  
        Return ResultUtil.Success (result);  
    }  
  
    @GetMapping ("/current")  
    public BaseResponse<User> getCurrentUser (HttpServletRequest request){  
        Object userObj = request.GetSession (). GetAttribute (USER_LOGIN_STATUS);  
        User userCurrent= (User) userObj;  
        If (userCurrent==null){  
            Return null;  
        }        //æ ¹æ®ç”¨æˆ· id å»æŸ¥è¯¢ç”¨æˆ·æ•°æ®åº“çš„å…·ä½“ä¿¡æ¯  
        Long userId = userCurrent.GetId ();  
        //todo æ ¡éªŒç”¨æˆ·æ˜¯å¦åˆæ³•  
        User user = userService.GetById (userId);  
        User result = userService.GetSafeUser (user);  
        Return ResultUtil.Success (result);  
    }  
  
   @GetMapping ("/search")  
    public BaseResponse<List<User>> searchUsers (@RequestBody String username, HttpServletRequest request){  
        //é‰´æƒï¼Œä»…ç®¡ç†å‘˜å¯ä»¥æŸ¥è¯¢  
       If (! IsAdmin (request)){  
           Return null;  
       }       List<User> result = userService.SearchUsers (username);  
       Return ResultUtil.Success (result);  
   }  
  
    @PostMapping ("delete")  
    public BaseResponse<Boolean> deleteUser (@RequestBody long id, HttpServletRequest request){  
        If (! IsAdmin (request)){  
            Return null;  
        }        if (id<=0){  
            Return null;  
        }        boolean result = userService.RemoveById (id);  
        Return ResultUtil.Success (result);  
    }  
  
    /**  
     * æ˜¯å¦ä¸ºç®¡ç†å‘˜  
     * @param request  
     * @return  
     */  
    Private boolean isAdmin (HttpServletRequest request){  
        //é‰´æƒï¼Œä»…ç®¡ç†å‘˜å¯ä»¥æŸ¥è¯¢  
        Object userObj = request.GetSession (). GetAttribute (USER_LOGIN_STATUS);  
        User user = (User) userObj;  
        If (user==null||user.GetUserRole ()!=ADMIN_ROLE){  
            Return false;  
        }        return true;  
    }  
}
```

#### å°è£…å…¨å±€å¼‚å¸¸å¤„ç†
- ä¹‹å‰ service å±‚æ ¡éªŒå¤±è´¥è¦ä¹ˆè¿”å›-1 è¦ä¹ˆè¿”å› null, è¿™æ ·å¯¹å‰ç«¯æç¤ºéå¸¸ä¸å‹å¥½ï¼Œå¯è¯»æ€§å·®
- <mark style="background: #ABF7F7A6;">å¯ä»¥å®šä¹‰ä¸€å¥—é€šç”¨çš„çŠ¶æ€ç </mark>
	- æˆåŠŸçŠ¶æ€
	- è¯·æ±‚å‚æ•°é”™è¯¯
	- è¯·æ±‚å‚æ•°ä¸ºç©º
	- æ— æƒé™
	- æœªç™»å½•
	- ç³»ç»Ÿå†…éƒ¨å¼‚å¸¸

> [!NOTE] ErrorCode
> æšä¸¾ä¸æ”¯æŒ `@Data` æ³¨è§£ï¼Œä¹Ÿä¸æ”¯æŒ set æ–¹æ³•ï¼Œç›¸å½“äºå¸¸é‡ä¸èƒ½ä¿®æ”¹
```java
Package com. Yhk. Usercenter. Common;  
  
/**  
 * @version 1.0  
 * @Author moresuo  
 * @Date 2023/12/11 22:28  
 * @æ³¨é‡Šå…¨å±€çŠ¶æ€ç   
 */  
Public enum ErrorCode {  
    SUCCESS (0,"ok",""),  
    PARAMS_ERROE (40000,"è¯·æ±‚å‚æ•°é”™è¯¯",""),  
    PARAMS_NULL_ERROE (40001,"è¯·æ±‚æ•°æ®ä¸ºç©º",""),  
    NO_AUTH (40101,"æ— æƒé™",""),  
    NOT_LOGIN (40100,"æœªç™»å½•","");  
    Private final int code;//çŠ¶æ€ç   
    Private final String message;//çŠ¶æ€ç ä¿¡æ¯  
    Private final String description;//çŠ¶æ€ç æè¿°  
  
    ErrorCode (int code, String message, String description) {  
        This. Code = code;  
        This. Message = message;  
        This. Description = description;  
    }  
    Public int getCode () {  
	    Return code;  
	}  
  
	Public String getMessage () {  
	    Return message;  
	}  
  
	Public String getDescription () {  
	    Return description;  
	}
}
```
- å°†é€šç”¨è¿”å›å¯¹è±¡ `BaseResponse` çš„å±æ€§ä¾èµ–äº `ErrorCode` çš„æšä¸¾
```java
Package com. Yhk. Usercenter. Common;  
  
Import lombok. Data;  
  
Import java. Io. Serializable;  
  
/**  
 * @version 1.0  
 * @Author moresuo  
 * @Date 2023/12/11 21:03  
 * @æ³¨é‡Šé€šç”¨è¿”å›ç±»  
 */  
@Data  
public class BaseResponse<T> implements Serializable {  
    Private static final long serialVersionUID = -7506108714914421400 L;  
    Private Integer code;  
    Private T data;  
    Private String message;  
    Private String description;  
  
    Public BaseResponse (Integer code, T data, String message, String description) {  
        This. Code = code;  
        This. Data = data;  
        This. Message = message;  
        This. Description=description;  
    }  
    Public BaseResponse (Integer code, T data, String message) {  
        This. Code = code;  
        This. Data = data;  
        This. Message = message;  
    }  
  
    Public BaseResponse (Integer code, T data) {  
        This. Code = code;  
        This. Data = data;  
        This. Message="";  
    }  
    Public BaseResponse (ErrorCode errorCode){  
        This (errorCode.GetCode (), null, errorCode.GetMessage (), errorCode.GetDescription ());  
    }  
  
}
```

<mark style="background: #FFB86CA6;">å¯èƒ½ä½ ä¼šå‘ç°é€šè¿‡ ErroeCode ä¹Ÿå¯ä»¥è¿”å›æˆåŠŸä¿¡æ¯ï¼Œé‚£ä¸ºä»€ä¹ˆè¿˜è¦å•ç‹¬å®šä¹‰ä¸€ä¸ª success æ–¹æ³•</mark>
>å¦‚æœå•çº¯çš„è¿”å›ä¸€ä¸ªæˆåŠŸä¿¡æ¯ï¼Œè€Œä¸ç”¨è¿”å›ä»»ä½•ä»åç«¯è·å–çš„æ•°æ®ï¼Œå°±ä½¿ç”¨ ErrorCode å³å¯
>å¦‚æœè¿”å›æˆåŠŸä¿¡æ¯çš„åŒæ—¶è¿˜è¦æºå¸¦ä»åç«¯è·å–çš„æ•°æ®ä¿¡æ¯ï¼ˆdataï¼‰ï¼Œé‚£å°±å¯ä»¥è°ƒç”¨ success æ–¹æ³•

ä½ å¯èƒ½è§‰å¾—å½“å‰çš„ `ResultUtil` å·²ç»å¾ˆå®Œç¾äº†ï¼Œè¿”å›æˆåŠŸå’Œé”™è¯¯çš„ä¿¡æ¯ï¼Œä½†è¿™ä¸ªåªå±€é™äº controller å±‚ï¼Œ<mark style="background: #FF5582A6;">å¦‚æœåœ¨å…¶ä»–ç±»ä¸­å‘¢ï¼Œå¯èƒ½å°±ä¸ä»…ä»…åªæ˜¯è¿”å›æˆåŠŸå’Œé”™è¯¯çš„ä¿¡æ¯</mark>ï¼Œæ‰€ä»¥æœ‰äº†å…¨å±€å¼‚å¸¸å¤„ç†ç±»

1. å®šä¹‰ä¸šåŠ¡å¼‚å¸¸ç±»
- ç›¸å¯¹äº java çš„å¼‚å¸¸ç±»ï¼Œæ”¯æŒæ›´å¤šå­—æ®µ
- è‡ªå®šä¹‰æ„é€ å‡½æ•°ï¼Œæ›´çµæ´»å¿«æ·è®¾ç½®å­—æ®µ

> [!NOTE] BusinessException
```java
Package com. Yhk. Usercenter. Exception;  
  
Import com. Yhk. Usercenter. Common. ErrorCode;  
  
/**  
 * @version 1.0  
 * @Author moresuo  
 * @Date 2023/12/11 23:00  
 * @æ³¨é‡Šè‡ªå®šä¹‰å¼‚å¸¸ç±»  
 */  
Public class BusinessException extends RuntimeException {  
    Private final int code;  
    Private final String description;  
    Public BusinessException (String message, int code, String description){  
        Super (message);//å¼‚å¸¸ä¿¡æ¯äº¤ç»™ RuntimeException å»æ˜¾ç¤º  
        This. Code=code;  
        This. Description=description;  
    }  
    Public BusinessException (ErrorCode errorCode){  
        Super (errorCode.GetMessage ());  
        This. Code=errorCode.GetCode ();  
        This. Description=errorCode.GetDescription ();  
    }  
	Public BusinessException (ErrorCode errorCode, String description){  
	    Super (errorCode.GetMessage ());  
	    This. Code=errorCode.GetCode ();  
	    This. Description=description;  
	}
  
    Public int getCode () {  
        Return code;  
    }  
  
    Public String getDescription () {  
        Return description;  
    }  
}
```
- å°†ä¹‹å‰è¿”å›çš„é”™è¯¯æ ¡éªŒä¿¡æ¯æ›´æ¢ä¸ºæŠ›å‡ºå¼‚å¸¸
2. ç¼–å†™å…¨å±€å¼‚å¸¸å¤„ç†å™¨
- æ•è·ä»£ç ä¸­æ‰€æœ‰å¼‚å¸¸ï¼Œé›†ä¸­å¤„ç†ï¼Œè®©å‰ç«¯å¾—åˆ°æ›´è¯¦ç»†çš„ä¸šåŠ¡æŠ¥é”™
- å¦‚æœä¸å°†å¼‚å¸¸ä¿¡æ¯å±è”½æ‰çš„å¯èƒ½ä¼šç»™å‰ç«¯æš´éœ²ä¸€äº›åç«¯æ¥å£ä¿¡æ¯ï¼Œå­˜åœ¨å®‰å…¨éšæ‚£é—®é¢˜
![[Pasted image 20231211233239.png]]
- åˆ©ç”¨ Spring AOP åˆ‡é¢ï¼Œåœ¨æ–¹æ³•è°ƒç”¨å‰åè¿›è¡Œé›†ä¸­å¤„ç†
- `@RestControllerAdvice` æ³¨è§£å®šä¹‰ä¸€ä¸ªåˆ‡é¢ç±»
- `@ExceptionHandler` ç”¨åœ¨æ–¹æ³•ä¸Šï¼Œå±æ€§ä¸ºå¼‚å¸¸ç±»çš„ class å¯¹è±¡ï¼Œè¡¨ç¤ºæ•è·æŒ‡å®šå¼‚å¸¸
```java
Package com. Yhk. Usercenter. Exception;  
  
Import com. Yhk. Usercenter. Common. BaseResponse;  
Import com. Yhk. Usercenter. Common. ErrorCode;  
Import com. Yhk. Usercenter. Common. ResultUtil;  
Import lombok. Extern. Slf 4 j. Slf 4 j;  
Import org. Springframework. Web. Bind. Annotation. ExceptionHandler;  
Import org. Springframework. Web. Bind. Annotation. RestControllerAdvice;  
  
/**  
 * @version 1.0  
 * @Author moresuo  
 * @Date 2023/12/11 23:33  
 * @æ³¨é‡Šå…¨å±€å¼‚å¸¸å¤„ç†å™¨  
 */  
@RestControllerAdvice  
@Slf 4 j  
Public class GlobalExceptionHandler {  
    @ExceptionHandler (BusinessException. Class)  
    Public BaseResponse businessExceptionHandler (BusinessException e){  
        log.Error ("business: "+e.getMessage (), e);  
        return ResultUtil.Error (e.getCode (), e.getMessage (), e.getDescription ());  
    }  
  
    @ExceptionHandler (RuntimeException. Class)  
    Public BaseResponse businessExceptionHandler (RuntimeException e){  
        Log.Error ("runtime: ", e);  
        return ResultUtil.Error (ErrorCode. SYSTEM_ERROE, e.getMessage (), "");  
    }  
}
```
#### å…¨å±€è¯·æ±‚æ—¥å¿—å’Œç™»å½•æ ¡éªŒ

## éƒ¨ç½²
### å¤šç¯å¢ƒ
å‚è€ƒæ–‡ç« ï¼š[å¤šç¯å¢ƒè®¾è®¡-CSDNåšå®¢](https://blog.csdn.net/weixin_41701290/article/details/120173283)
<mark style="background: #ABF7F7A6;">åŒä¸€å¥—é¡¹ç›®ä»£ç åœ¨ä¸åŒé˜¶æ®µéœ€è¦æ ¹æ®å®é™…æƒ…å†µæ¥éƒ¨ç½²åˆ°ä¸åŒçš„æœºå™¨ä¸Š</mark>
ä¼˜ç‚¹ï¼š
- æ¯ä¸ªç¯å¢ƒäº’ä¸å½±å“
- ä¸ºäº†åŒºåˆ†ä¸åŒçš„é˜¶æ®µï¼šå¼€å‘/æµ‹è¯•/ç”Ÿäº§ç¯å¢ƒ
- å¯¹é¡¹ç›®è¿›è¡Œä¼˜åŒ–
	- æœ¬åœ°æ—¥å¿—çº§åˆ«
	- ç²¾ç®€ä¾èµ–ï¼ŒèŠ‚çœé¡¹ç›®ä½“ç§¯
	- é¡¹ç›®ç¯å¢ƒ/å‚æ•°å¯ä»¥è°ƒæ•´
é’ˆå¯¹ä¸åŒç¯å¢ƒåšä¸åŒçš„äº‹æƒ…

**å¤šç¯å¢ƒåˆ†ç±»ï¼š**
1. æœ¬åœ°ç¯å¢ƒï¼šlocalhost
2. å¼€å‘ç¯å¢ƒï¼ˆè¿œç¨‹å¼€å‘ï¼‰ï¼Œå¤§å®¶æ¥è¿åŒä¸€å°æœºå™¨
3. æµ‹è¯•ç¯å¢ƒï¼Œç‹¬ç«‹çš„æœåŠ¡å™¨ï¼Œç‹¬ç«‹çš„æ•°æ®åº“ï¼ˆå•å…ƒæµ‹è¯•/åŠŸèƒ½æµ‹è¯•/ç³»ç»Ÿé›†æˆæµ‹è¯•/æ€§èƒ½æµ‹è¯•ï¼‰
4. é¢„å‘å¸ƒç¯å¢ƒï¼ˆä½“éªŒæœï¼‰
5. æ­£å¼ç¯å¢ƒï¼ˆçº¿ä¸Šå¯¹å¤–å…¬å¼€è®¿é—®ç¯å¢ƒï¼‰ï¼Œå°½é‡ä¸è¦æ”¹åŠ¨
6. æ²™ç®±/å®éªŒç¯å¢ƒ
#### å‰ç«¯å¤šç¯å¢ƒ
- è¯·æ±‚åœ°å€
	- å¼€å‘ç¯å¢ƒï¼šlocahost:8080
	- çº¿ä¸Šç¯å¢ƒ: moresuo. Top
- å¯åŠ¨æ–¹å¼
	- å¼€å‘ç¯å¢ƒï¼šnpm run start
	- çº¿ä¸Šç¯å¢ƒï¼šnpm run build (é¡¹ç›®æ„å»ºæ‰“åŒ…)ï¼Œä½¿ç”¨ `serve` è¿›è¡Œè°ƒè¯•ï¼ˆå®‰è£… serve: `npm install -g serve`ï¼‰, ç›¸å½“äºä¸€ä¸ªæœ¬åœ° web æœåŠ¡å™¨
- é¡¹ç›®é…ç½®
	- å¯ä»¥åœ¨é…ç½®æ–‡ä»¶åæ·»åŠ å¯¹åº”çš„ç¯å¢ƒåç§°åç¼€æ¥åŒºåˆ†å¼€å‘ç¯å¢ƒå’Œç”Ÿäº§ç¯å¢ƒ
	- å¼€å‘ç¯å¢ƒï¼šconfig. Dev. Ts
	- ç”Ÿäº§ç¯å¢ƒï¼šconfig. Prod. Ts
#### åç«¯å¤šç¯å¢ƒ
é€šè¿‡ä¿®æ”¹ application é…ç½®æ–‡ä»¶çš„åç¼€æ¥è¡¨ç¤ºä¸åŒçš„ç¯å¢ƒ
![[Pasted image 20231218174528.png]]
å°†åˆ›å»ºçš„è¡¨çš„ DDL ä¿å­˜ä¸‹æ¥æ”¾å…¥ä¸€ä¸ªæ–‡ä»¶ä¸­
![[Pasted image 20231218184811.png]]


<mark style="background: #ABF7F7A6;">å¯ä»¥åœ¨å¯åŠ¨é¡¹ç›®æ—¶ä¼ å…¥å¯åŠ¨å˜é‡</mark>
![[Pasted image 20231218214215.png]]
![[Pasted image 20231218215612.png]]
![[Pasted image 20231218220628.png]]

> [!NOTE] é—®é¢˜-æ²¡æœ‰ä¸»æ¸…å•å±æ€§
> ![[Pasted image 20231218220729.png]]
> åœ¨ spring-boot-maven-plugin çš„é…ç½®ä¸­è®¾ç½® <skip>true</skip> æ—¶ï¼Œå®é™…ä¸Šä½ å‘Šè¯‰ Maven åœ¨æ‰§è¡Œæ„å»ºç”Ÿå‘½å‘¨æœŸæ—¶è·³è¿‡è¿™ä¸ªæ’ä»¶çš„è¿è¡Œã€‚æ­¤æ’ä»¶è´Ÿè´£å°†ä½ çš„é¡¹ç›®æ‰“åŒ…æˆä¸€ä¸ªå¯æ‰§è¡Œçš„ JAR æ–‡ä»¶ï¼Œå…¶ä¸­åŒ…å«äº†ä¸€ä¸ªæ­£ç¡®çš„æ¸…å•æ–‡ä»¶ï¼ˆMANIFEST. MFï¼‰ä»¥åŠæ‰€æœ‰çš„é¡¹ç›®ä¾èµ–é¡¹ã€‚
åœ¨æ¸…å•æ–‡ä»¶ä¸­ï¼Œä¸»ç±»ï¼ˆMain Classï¼‰çš„ä¿¡æ¯æ˜¯ä¸€ä¸ªå…³é”®çš„å…ƒç´ ï¼Œå®ƒå‘Šè¯‰ JVM è¿è¡Œå“ªä¸€ä¸ªç±»çš„ main æ–¹æ³•ä½œä¸ºç¨‹åºçš„å…¥å£ç‚¹ã€‚å¦‚æœ spring-boot-maven-plugin è¢«è·³è¿‡äº†ï¼Œé‚£ä¹ˆè¿™ä¸ªæ¸…å•æ–‡ä»¶å¯èƒ½ä¸ä¼šè¢«æ­£ç¡®åœ°ç”Ÿæˆï¼Œä¸»ç±»çš„ä¿¡æ¯ä¹Ÿå°±ä¸ä¼šè¢«åŠ å…¥åˆ°æ¸…å•æ–‡ä»¶ä¸­ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆå½“ä½ å°è¯•è¿è¡Œ JAR æ–‡ä»¶æ—¶ï¼Œä½ ä¼šçœ‹åˆ° "æ²¡æœ‰ä¸»æ¸…å•å±æ€§" çš„é”™è¯¯ã€‚
æ‰€ä»¥ï¼Œä¸ºäº†æ­£ç¡®ç”Ÿæˆå¯æ‰§è¡Œçš„ JAR æ–‡ä»¶ï¼Œéœ€è¦ç§»é™¤ <skip>true</skip> é…ç½®ï¼Œæˆ–è€…å°†å…¶è®¾ç½®ä¸º falseã€‚è¿™æ ·ï¼Œåœ¨æ‰§è¡Œ mvn package æˆ–è€… mvn install æ—¶ï¼Œspring-boot-maven-plugin å°±ä¼šè¢«æ‰§è¡Œï¼Œå®ƒä¼šç”Ÿæˆä¸€ä¸ªæ­£ç¡®çš„å¯æ‰§è¡Œçš„ JAR æ–‡ä»¶ï¼ŒåŒ…å«äº†ä¸»ç±»çš„ä¿¡æ¯ä»¥åŠæ‰€æœ‰çš„é¡¹ç›®ä¾èµ–é¡¹

### é¡¹ç›®éƒ¨ç½²
#### åŸå§‹éƒ¨ç½²
>ä»€ä¹ˆéƒ½è‡ªå·±è£…

**å‰ç«¯**
éœ€è¦ web æœåŠ¡å™¨ï¼šnginx
å‚è€ƒæ–‡æ¡£ï¼š[nginxå®‰è£…åŠå…¶é…ç½®è¯¦ç»†æ•™ç¨‹ - çŸ¥ä¹ (zhihu.com)](https://zhuanlan.zhihu.com/p/83890573)
1. å®˜ç½‘ï¼š[nginxï¼šä¸‹è½½](https://nginx.org/en/download.html)
2. ![[Pasted image 20231218224951.png]]
3. å°†ä¸‹è½½çš„å‹ç¼©åŒ…ä¼ åˆ° linux ä¸‹
4. åˆ›å»ºä¸€ä¸ªç›®å½•ç”¨ä¸å­˜æ”¾ nginx
```shell
[ root@moresuo ~]# mkdir service
[ root@moresuo ~]# ll
Total 1132
drwxr-xr-x 2 root root    4096 Nov 28 20:42 halo
-rw-r--r-- 1 root root   34763 Nov 22 17:29 install. Sh
-rw-r--r-- 1 root root 1112471 Dec 18 22:51 nginx-1.24.0. Tar. Gz
drwxr-xr-x 2 root root    4096 Dec 18 22:51 service
[ root@moresuo ~]# mv nginx-1.24.0. Tar. Gz service
[ root@moresuo ~]# ll
Total 44
drwxr-xr-x 2 root root  4096 Nov 28 20:42 halo
-rw-r--r-- 1 root root 34763 Nov 22 17:29 install. Sh
drwxr-xr-x 2 root root  4096 Dec 18 22:52 service
[ root@moresuo ~]# cd service
[ root@moresuo service]# ll
Total 1088
-rw-r--r-- 1 root root 1112471 Dec 18 22:51 nginx-1.24.0. Tar. Gz
```
5. è§£å‹ nginx
```shell
[ root@moresuo service]# tar -zxvf nginx-1.24.0. Tar. Gz
```
6. è¿›å…¥ nginx-1.24.0 æ–‡ä»¶
7. æ‰§è¡Œ configure æ–‡ä»¶
```shell
[ root@moresuo nginx-1.24.0]# . Configure
```
8. ç¼–è¯‘ nginx
```shell
Make
```
9. å®‰è£…
```shell
Make install
```
10. ä¿®æ”¹ç¯å¢ƒå˜é‡
```shell
Vim /etc/profile
```
![[Pasted image 20231218231425.png]]
11. é‡æ–°æ¿€æ´»é…ç½®æ–‡ä»¶ï¼Œå¦åˆ™è¿˜æ˜¯æ— æ•ˆ
```shell
Source /etc/profile
```
12. å°†å‰ç«¯é¡¹ç›®æ‰“åŒ…ä¼ åˆ° linux
![[Pasted image 20231218232427.png]]
![[Pasted image 20231218232453.png]]
13. è§£å‹åˆ°æŒ‡å®šç›®å½•ä¸‹
```shell
[ root@moresuo service]# unzip dist. Zip -d user-center-front
```
14. è¿›å…¥åˆ° nginx é…ç½®æ–‡ä»¶ç›®å½•ä¸‹ï¼Œä¿®æ”¹é…ç½®æ–‡ä»¶
```shell
[ root@moresuo service]# cd nginx-1.24.0
[ root@moresuo nginx-1.24.0]# ls
CHANGES  CHANGES. Ru  LICENSE  Makefile  README  auto  conf  configure  contrib  html  man  objs  src
[ root@moresuo nginx-1.24.0]# cd conf
[ root@moresuo conf]# vim nginx. Conf
```
![[Pasted image 20231218233207.png]]
![[Pasted image 20231218234723.png]]

**åç«¯**
>å®‰è£… JDK, maven

```shell
[ root@moresuo conf]# yum install -y java-1.8.0-openjdk*
```
Maven å®˜ç½‘ä¸‹è½½ï¼š[Maven â€“ Download Apache Maven](https://maven.apache.org/download.cgi)
![[Pasted image 20231218235501.png]]
<mark style="background: #ABF7F7A6;">å¤åˆ¶ maven ä¸‹è½½é“¾æ¥</mark>
```shell
[ root@moresuo service]# curl -o apache-maven-3.9.6-bin. Tar. Gz https://dlcdn.apache.org/maven/maven-3/3.9.6/binaries/apache-maven-3.9.6-bin.tar.gz
```
<mark style="background: #ABF7F7A6;">å°†ä»£ç ä»“åº“ä¸­çš„åç«¯ä»£ç å…‹éš†åˆ° linux ä¸­</mark>
```shell
[ root@moresuo service]# git https://gitee.com/moresuo/user-center.git
```
![[Pasted image 20231219001602.png]]
<mark style="background: #ABF7F7A6;">ç»™é¡¹ç›®çš„ jar åŒ…èµ‹äºˆå¯æ‰§è¡Œæƒé™</mark>
```shell
[ root@moresuo target]# chmod a+x user-center-0.0.1-SNAPSHOT. Jar
```
![[Pasted image 20231219083807.png]]
<mark style="background: #ABF7F7A6;">å¯åŠ¨ä¹‹åè®©é¡¹ç›®åœ¨åå°è¿è¡Œ</mark>
```shell
[nohup java -jar](<[root@moresuo target]# nohup java -jar ./user-center-0.0.1-SNAPSHOT.jar &>)
```
![[Pasted image 20231219091721.png]]
`jps` å‘½ä»¤æŸ¥çœ‹æ‰€æœ‰å·¥ä½œçš„ java è¿›ç¨‹
#### å®å¡”å®‰è£…
**å®å¡”ï¼š**ï¼šä¸€ä¸ª linux è¿ç»´å¯è§†åŒ–æ§åˆ¶é¢æ¿
>æ–¹ä¾¿ç®¡ç†æœåŠ¡å™¨ï¼Œå®‰è£…è½¯ä»¶
![[Pasted image 20231219093400.png]]
![[Pasted image 20231219101643.png]]
![[Pasted image 20231219101722.png]]
![[Pasted image 20231219101555.png]]
![[Pasted image 20231219102533.png]]
![[Pasted image 20231219102552.png]]
![[Pasted image 20231219104358.png]]

#### Docker éƒ¨ç½²
Docker æ˜¯å®¹å™¨ï¼Œå¯ä»¥å°†é¡¹ç›®ä¾èµ–çš„ç¯å¢ƒï¼ˆjava, nginxï¼‰å’Œé¡¹ç›®ä»£ç æ‰“åŒ…æˆé•œåƒï¼Œé•œåƒæ›´å®¹æ˜“åˆ†å‘å’Œç§»æ¤ï¼Œå†å¯åŠ¨é¡¹ç›®æ—¶ï¼Œä¸éœ€è¦æ•²ä¸€å¤§å †å‘½ä»¤ï¼Œç›´æ¥ä¸‹è½½é•œåƒï¼Œå¯åŠ¨é•œåƒå³å¯è¿è¡Œé¡¹ç›®ï¼Œå¯ä»¥ç†è§£ä¸ºä¸ºä¸€ä¸ªå®‰è£…åŒ…ï¼Œä¸€ä¸ªæ²™ç›’ç¯å¢ƒï¼Œåœ¨æ²™ç›’é‡Œéƒ¨ç½²çš„ç¯å¢ƒåªä½œç”¨äºæ²™ç›’å†…çš„é¡¹ç›®ï¼Œè€Œä¸ä¼šå¹²æ‰°æ²™ç›’å¤–çš„äº‹ç‰©ï¼Œè€Œä¸”å¯ä»¥å­˜åœ¨å¤šä¸ª docker å®¹å™¨ï¼Œæ„æ€æ˜¯å¯ä»¥å­˜åœ¨å¤šä¸ªé¡¹ç›®çš„éƒ¨ç½²è€Œé…ç½®ç¯å¢ƒä¾èµ–äº’ä¸å¹²æ‰°
